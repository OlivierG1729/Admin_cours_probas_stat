group = type_menage_rename))+
# position = position_dodge(0.9),
# vjust = -0.5)) +
scale_fill_brewer(palette="Paired") +
labs(y = "Part des seniors (en %)",
fill = "Type de ménage") +
theme(legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 14))
g1
# d. par CSP du conjoint à l'entrée
comp2 <- full_base %>%
mutate(CSP_CJ_8_entree = case_when(CSP_CJ_8_entree=="1 agri" ~ "Agriculteurs exploitants",
CSP_CJ_8_entree=="2 artisan chef entr" ~ "Artisans, commerçants, chefs d'entreprises",
CSP_CJ_8_entree=="3 cadre" ~ "Cadres et professions intellectuelles supérieures",
CSP_CJ_8_entree=="4 intermed" ~ "Professions intermédiaires",
CSP_CJ_8_entree=="5 employe" ~ "Employés",
CSP_CJ_8_entree=="6 ouvrier" ~ "Ouvriers",
CSP_CJ_8_entree=="8 sans acti" ~ "Sans activité",
CSP_CJ_8_entree=="9 NR" ~ "Non répondants",
CSP_CJ_8_entree=="10 NC" ~ " Non concerné"
)
) %>%
group_by(base_imputation, CSP_CJ_8_entree) %>%
summarise(n_w = sum(poids_cales)) %>%
mutate(prop_w = round(100*n_w/sum(n_w), 1),
y_pos = sum(prop_w)-cumsum(prop_w)+prop_w/2)
g2 <- ggplot(comp2, aes(x = base_imputation, y = prop_w))+
geom_col(aes(fill = CSP_CJ_8_entree), width = 0.5) +
geom_text(aes(y = y_pos,
label = prop_w,
group = CSP_CJ_8_entree))+
# position = position_dodge(0.9),
# vjust = -0.5)) +
scale_fill_brewer(palette="Paired") +
labs(y = "Part des seniors (en %)",
fill = "CSP du conjoint à l'entrée en établissement") +
theme(legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 14))
g2
# e. par CSP
comp3 <- full_base %>%
mutate(csp_8_rename = case_when(CSP_8=="1 agri" ~ "Agriculteurs exploitants",
CSP_8=="2 artisan chef entr" ~ "Artisans, commerçants, chefs d'entreprises",
CSP_8=="3 cadre" ~ "Cadres et professions intellectuelles supérieures",
CSP_8=="4 intermed" ~ "Professions intermédiaires",
CSP_8=="5 employe" ~ "Employés",
CSP_8=="6 ouvrier" ~ "Ouvriers",
CSP_8=="8 sans acti" ~ "Sans activité",
CSP_8=="9 NR" ~ "Non répondants")) %>%
group_by(base_imputation, csp_8_rename) %>%
summarise(n_w = sum(poids_cales)) %>%
mutate(prop_w = round(100*n_w/sum(n_w), 1),
y_pos = sum(prop_w)-cumsum(prop_w)+prop_w/2)
g3 <- ggplot(comp3, aes(x = base_imputation, y = prop_w))+
geom_col(aes(fill = csp_8_rename), width = 0.6) +
geom_text(aes(y = y_pos+c(rep(0, 7), -1.5),
label = prop_w,
group = csp_8_rename)) +
# position = position_dodge(0.9),
# vjust = -0.5)) +
scale_fill_brewer(palette="Paired") +
labs(y = "Part des seniors (en %)",
fill = "CSP") +
theme(axis.title.x = element_blank(),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 14))
g3
# f. par statut d'aide au logement
# NOTE 21/03 : variable AIDELOG pas disponble --> pourquoi ?
comp5 <- full_base %>%
group_by(base_imputation, AIDELOG) %>%
summarise(n_w = sum(poids_cales)) %>%
mutate(prop_w = round(100*n_w/sum(n_w), 1),
y_pos = sum(prop_w)-cumsum(prop_w)+prop_w/2)
g5 <- ggplot(comp5, aes(x = base_imputation, y = prop_w))+
geom_col(aes(fill = AIDELOG), width = 0.6) +
geom_text(aes(y = y_pos+c(rep(0, 7), -1.5),
label = prop_w,
group = AIDELOG)) +
# position = position_dodge(0.9),
# vjust = -0.5)) +
scale_fill_brewer(palette="Paired") +
labs(y = "Part des seniors (en %)",
fill = "Aide au logement") +
theme(axis.title.x = element_blank(),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 14))
g5
# par région (IDF ou autre)
comp6 <- full_base %>%
group_by(base_imputation, region) %>%
summarise(n_w = sum(poids_cales)) %>%
mutate(prop_w = round(100*n_w/sum(n_w), 1),
y_pos = sum(prop_w)-cumsum(prop_w)+prop_w/2)
g6 <- ggplot(comp6, aes(x = base_imputation, y = prop_w))+
geom_col(aes(fill = region), width = 0.6) +
geom_text(aes(y = y_pos+c(rep(0, 7), -1.5),
label = prop_w,
group = region)) +
# position = position_dodge(0.9),
# vjust = -0.5)) +
scale_fill_brewer(palette="Paired") +
labs(y = "Part des seniors (en %)",
fill = "Région") +
theme(axis.title.x = element_blank(),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 14))
g6
# par CSP du conjoint décédé
comp7 <- full_base %>%
mutate(CSP_CJ_DCD_8_entree = case_when(CSP_CJ_DCD_8_entree=="1 agri" ~ "Agriculteurs exploitants",
CSP_CJ_DCD_8_entree=="2 artisan chef entr" ~ "Artisans, commerçants, chefs d'entreprises",
CSP_CJ_DCD_8_entree=="3 cadre" ~ "Cadres et professions intellectuelles supérieures",
CSP_CJ_DCD_8_entree=="4 intermed" ~ "Professions intermédiaires",
CSP_CJ_DCD_8_entree=="5 employe" ~ "Employés",
CSP_CJ_DCD_8_entree=="6 ouvrier" ~ "Ouvriers",
CSP_CJ_DCD_8_entree=="8 sans acti" ~ "Sans activité",
CSP_CJ_DCD_8_entree=="9 NR" ~ "Non répondants",
CSP_CJ_DCD_8_entree=="10 NC" ~ " Non concerné")) %>%
group_by(base_imputation, CSP_CJ_DCD_8_entree) %>%
summarise(n_w = sum(poids_cales)) %>%
mutate(prop_w = round(100*n_w/sum(n_w), 1),
y_pos = sum(prop_w)-cumsum(prop_w)+prop_w/2)
g7 <- ggplot(comp7, aes(x = base_imputation, y = prop_w))+
geom_col(aes(fill = CSP_CJ_DCD_8_entree), width = 0.5) +
geom_text(aes(y = y_pos,
label = prop_w,
group = CSP_CJ_DCD_8_entree))+
# position = position_dodge(0.9),
# vjust = -0.5)) +
scale_fill_brewer(palette="Paired") +
labs(y = "Part des seniors (en %)",
fill = "CSP du conjoint décédé") +
theme(legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 14))
g7
# i. par statut de détention de revenus fonciers
comp8 <- full_base %>%
mutate(RFONC = ifelse(RFONC==1, "Oui", "Non")) %>%
group_by(base_imputation, RFONC) %>%
summarise(n_w = sum(poids_cales)) %>%
mutate(prop_w = round(100*n_w/sum(n_w), 1),
y_pos = sum(prop_w)-cumsum(prop_w)+prop_w/2)
g8 <- ggplot(comp8, aes(x = base_imputation, y = prop_w))+
geom_col(aes(fill = RFONC), width = 0.5) +
geom_text(aes(y = y_pos,
label = prop_w,
group = RFONC))+
# position = position_dodge(0.9),
# vjust = -0.5)) +
scale_fill_brewer(palette="Paired") +
labs(y = "Part des seniors (en %)",
fill = "Perception de revenus fonciers") +
theme(legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 14))
g8
# j. par statut de perception de rentes viagères à titre onéréux
comp9 <- full_base %>%
mutate(RTO_FOYER_I = ifelse(RTO_FOYER_I==0, "Non", "Oui")) %>%
group_by(base_imputation, RTO_FOYER_I) %>%
summarise(n_w = sum(poids_cales)) %>%
mutate(prop_w = round(100*n_w/sum(n_w), 1),
y_pos = sum(prop_w)-cumsum(prop_w)+prop_w/2)
g9 <- ggplot(comp9, aes(x = base_imputation, y = prop_w))+
geom_col(aes(fill = RTO_FOYER_I), width = 0.5) +
geom_text(aes(y = y_pos,
label = prop_w,
group = RTO_FOYER_I))+
# position = position_dodge(0.9),
# vjust = -0.5)) +
scale_fill_brewer(palette="Paired") +
labs(y = "Part des seniors (en %)",
fill = "Perception de rentes viagères à titre onéreux") +
theme(legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 14))
g9
# k. par statut de preception de revenus des valeurs mobilières
# soumis au prélèvement libératoire en 2014
comp10 <- full_base %>%
mutate(VAL_FOYER_I = ifelse(VAL_FOYER_I==0, "Non", "Oui")) %>%
group_by(base_imputation, VAL_FOYER_I) %>%
summarise(n_w = sum(poids_cales)) %>%
mutate(prop_w = round(100*n_w/sum(n_w), 1),
y_pos = sum(prop_w)-cumsum(prop_w)+prop_w/2)
g10 <- ggplot(comp10, aes(x = base_imputation, y = prop_w))+
geom_col(aes(fill = VAL_FOYER_I), width = 0.5) +
geom_text(aes(y = y_pos,
label = prop_w,
group = VAL_FOYER_I))+
# position = position_dodge(0.9),
# vjust = -0.5)) +
scale_fill_brewer(palette="Paired") +
labs(y = "Part des seniors (en %)",
fill = "Revenus de valeurs mobilières \n soumis au prélèvement \n libératoire") +
theme(legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 14))
g10
# l. par statut de perception de revenus des Valeurs mobilières
# non soumis au prélèvement libératoire en 2014
comp11 <- full_base %>%
mutate(VAM_FOYER_I = ifelse(VAM_FOYER_I==0, "Non", "Oui")) %>%
group_by(base_imputation, VAM_FOYER_I) %>%
summarise(n_w = sum(poids_cales)) %>%
mutate(prop_w = round(100*n_w/sum(n_w), 1),
y_pos = sum(prop_w)-cumsum(prop_w)+prop_w/2)
g11 <- ggplot(comp11, aes(x = base_imputation, y = prop_w))+
geom_col(aes(fill = VAM_FOYER_I), width = 0.5) +
geom_text(aes(y = y_pos,
label = prop_w,
group = VAM_FOYER_I))+
# position = position_dodge(0.9),
# vjust = -0.5)) +
scale_fill_brewer(palette="Paired") +
labs(y = "Part des seniors (en %)",
fill = "Revenus de valeurs mobilières \n non soumis au prélèvement \n libératoire") +
theme(legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 14))
g11
# m. par statut de propriété
comp12 <- full_base %>%
group_by(base_imputation, proprio_entree) %>%
summarise(n_w = sum(poids_cales)) %>%
mutate(prop_w = round(100*n_w/sum(n_w), 1),
y_pos = sum(prop_w)-cumsum(prop_w)+prop_w/2)
g12 <- ggplot(comp12, aes(x = base_imputation, y = prop_w))+
geom_col(aes(fill = proprio_entree), width = 0.5) +
geom_text(aes(y = y_pos,
label = prop_w,
group = proprio_entree))+
# position = position_dodge(0.9),
# vjust = -0.5)) +
scale_fill_brewer(palette="Paired") +
labs(y = "Part des seniors (en %)",
fill = "Propriétaire à l'entrée en établissement") +
theme(legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 14))
g12
# n. par statut de placement financier à l'entrée en
# établissement
comp13 <- full_base %>%
group_by(base_imputation, placement_entree) %>%
summarise(n_w = sum(poids_cales)) %>%
mutate(prop_w = round(100*n_w/sum(n_w), 1),
y_pos = sum(prop_w)-cumsum(prop_w)+prop_w/2)
g13 <- ggplot(comp13, aes(x = base_imputation, y = prop_w))+
geom_col(aes(fill = placement_entree), width = 0.5) +
geom_text(aes(y = y_pos,
label = prop_w,
group = placement_entree))+
# position = position_dodge(0.9),
# vjust = -0.5)) +
scale_fill_brewer(palette="Paired") +
labs(y = "Part des seniors (en %)",
fill = "Détention de placements financiers") +
theme(legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 14))
g13
# sauvegardes des graphiques
g0
ggsave(paste0(repertoire_graphiques,
"/by_age.png"),
g0,
width = 14,
height = 5)
g0b
ggsave(paste0(repertoire_graphiques,
"/by_age_cj.png"),
g0b,
width = 14,
height = 12)
g1
ggsave(paste0(repertoire_graphiques,
"/by_type_menage.png"),
g1,
width = 14,
height = 5)
g2
ggsave(paste0(repertoire_graphiques,
"/by_csp_cj.png"),
g2,
width = 14,
height = 12)
ggsave(paste0(repertoire_graphiques,
"/by_csp.png"),
g3,
width = 14,
height = 5)
g4
g5
ggsave(paste0(repertoire_graphiques,
"/by_aidelog.png"),
g5,
width = 14,
height = 5)
g6
ggsave(paste0(repertoire_graphiques,
"/by_region.png"),
g6,
width = 14,
height = 5)
g7
ggsave(paste0(repertoire_graphiques,
"/by_csp_cj_decede.png"),
g7,
width = 14,
height = 5)
g8
ggsave(paste0(repertoire_graphiques,
"/by_rfonc.png"),
g8,
width = 14,
height = 5)
g9
ggsave(paste0(repertoire_graphiques,
"/by_rentesviageres.png"),
g9,
width = 14,
height = 5)
g10
ggsave(paste0(repertoire_graphiques,
"/by_valeursmobilieres_soumis.png"),
g10,
width = 14,
height = 5)
g11
ggsave(paste0(repertoire_graphiques,
"/by_valeursmobilieres_nonsoumis.png"),
g11,
width = 14,
height = 5)
g12
ggsave(paste0(repertoire_graphiques,
"/by_proprio.png"),
g12,
width = 14,
height = 5)
g13
ggsave(paste0(repertoire_graphiques,
"/by_placementfinancier.png"),
g13,
width = 14,
height = 5)
# base Patrimoine après imputation
base_patri_impute <- full_base %>%
filter(base_imputation=="Patrimoine, après imp.") %>%
mutate(proprio_entree = ifelse(proprio_entree=="oui",
"Propriétaire",
"Non propriétaire"))
# lien entre être propriétaire et détenir des placements financiers
# (avant ou après imputation dans Patrimoine : c'est pareil, il n'y a pas de
# valeur manquante pour ces deux variables)
comp14 <- base_patri_impute %>%
group_by(proprio_entree, placement_entree) %>%
summarise(n_w = sum(poids_cales)) %>%
mutate(prop_w = round(100*n_w/sum(n_w), 1),
y_pos = sum(prop_w)-cumsum(prop_w)+prop_w/2)
g14 <- ggplot(comp14, aes(x = proprio_entree, y = prop_w))+
geom_col(aes(fill = placement_entree), width = 0.5) +
geom_text(aes(y = y_pos,
label = prop_w,
group = placement_entree))+
# position = position_dodge(0.9),
# vjust = -0.5)) +
scale_fill_brewer(palette="Paired") +
labs(y = "Part des seniors (en %)",
fill = "Détention de placement financier") +
theme(legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 14))
g15 <- ggplot(base_patri %>% filter(PATIMM<1000000 & PATFISOM_sans_cc<1000000),
aes(x = PATIMM, y = PATFISOM_sans_cc)) +
geom_point() +
geom_smooth(method = lm)
g15
# corrélation de 0,35 entre les deux types de patrimoine (pas beaucoup)
cor(base_patri$PATIMM, base_patri$PATFISOM)
# NOTE : tout le monde a du patrimoine dans Patrimoine 2014
test <- base_patri %>% filter(PATIMM==0 & PATFISOM==0) # 0 individu
test <- chisq.test(base_patri_dupliquee$placement_entree,
base_patri_dupliquee$proprio_entree)
test
# Préparation des données
base_patri_patimmo <- base_patri %>%
mutate(type_pat = "Patrimoine immobilier",
pat = PATIMM)
base_patri_patfin_sanscc <- base_patri %>%
mutate(type_pat = "Patrimoine financier (sans compte courant)",
pat = PATFISOM_sans_cc)
base_patri_allpat <- rbind(base_patri_patimmo,
base_patri_patfin_sanscc)
# Patrimoine moyen par type de ménage
patmoyen_menage <- base_patri_allpat %>%
mutate(type_menage_rename = case_when(type_menage=="f seule" ~ "Femmes seules",
type_menage=="h seul" ~ "Hommes seuls",
type_menage=="couple" ~ "Couples",
type_menage=="veuf" ~ "Veufs",
type_menage=="veuve" ~ "Veuves")) %>%
group_by(type_pat, type_menage_rename) %>%
mutate(pat_moy = round(mean(pat)/1000, 1))
g2a <- ggplot(patmoyen_menage, aes(x = type_menage_rename, y = pat_moy)) +
geom_col(aes(fill = type_pat),
position = "dodge",
width = 0.8) +
geom_text(
aes(label = pat_moy, group = type_pat),
position = position_dodge(1),
vjust = -0.5
) +
scale_y_continuous(breaks = seq(0, 700, 100)) +
labs(y = "Patrimoine moyen (en milliers d'euros)",
x = "Type de ménage",
fill = "Type patrimoine") +
theme(legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.x = element_text(size = 14),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 16, angle = 90, hjust = 0.95, vjust = 0.2))
g2a
# Patrimoine moyen par CSP
patmoyen_csp <- base_patri_allpat %>%
mutate(csp_8_rename = case_when(CSP_8=="1 agri" ~ "Agriculteurs exploitants",
CSP_8=="2 artisan chef entr" ~ "Artisans, commerçants, chefs d'entreprises",
CSP_8=="3 cadre" ~ "Cadres et professions intellectuelles supérieures",
CSP_8=="4 intermed" ~ "Professions intermédiaires",
CSP_8=="5 employe" ~ "Employés",
CSP_8=="6 ouvrier" ~ "Ouvriers",
CSP_8=="8 sans acti" ~ "Sans activité",
CSP_8=="9 NR" ~ "Non répondants")) %>%
group_by(type_pat, csp_8_rename) %>%
mutate(pat_moy = round(mean(pat)/1000, 1))
g2b <- ggplot(patmoyen_csp, aes(x = csp_8_rename, y = pat_moy)) +
geom_col(aes(fill = type_pat),
position = "dodge",
width = 0.8) +
geom_text(
aes(label = pat_moy, group = type_pat),
position = position_dodge(1),
vjust = -0.5
) +
scale_y_continuous(breaks = seq(0, 700, 100)) +
labs(y = "Patrimoine moyen (en milliers d'euros)",
x = "CSP",
fill = "Type patrimoine") +
theme(legend.title = element_text(size = 14),
legend.text = element_text(size = 12),
axis.title.x = element_text(size = 14),
axis.title.y = element_text(size = 14),
axis.text.x = element_text(size = 16, angle = 90, hjust = 0.95, vjust = 0.2))
g2b
# Sauvegarde
ggsave(paste0(repertoire_graphiques,
"/patrimoine_par_type_menage.png"),
g2a,
width=16,
height = 10)
ggsave(paste0(repertoire_graphiques,
"/patrimoine_par_csp.png"),
g2b,
width=16,
height = 15)
rm(list=ls())
library(ggplot2)
library(mice)
library(dplyr)
library(data.table)
library(survey)
library(descr)
library(openxlsx)
library(reldist)
library(stringr)
library(ggpubr)
library(forcats)
library(ggmosaic)
dossier_data <- "C:/Users/olivier.guin/Travail/Autonomix/Travaux/Sujet_grignotage_patrimoine/Code"
help(calibration)
library(icarus)
help(calibration)
